<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>User.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">demo</a> &gt; <a href="index.source.html" class="el_package">edu.ntnu.g14</a> &gt; <span class="el_source">User.java</span></div><h1>User.java</h1><pre class="source lang-java linenums">package edu.ntnu.g14;

import edu.ntnu.g14.frontend.ApplicationObjects;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.function.Supplier;
import java.util.stream.Collectors;
import java.util.stream.Stream;

/**
 * The User class represents a user in the banking system.
 * It inherits from the Personalia class.
 */
public class User extends Personalia {
    private final List&lt;Account&gt; accounts;
    private final List&lt;Invoice&gt; invoices;
    private final List&lt;Transaction&gt; transactions;
    private Budget budget;
    private static final String CSV_DELIMITER = &quot;,&quot;;

    /**
    * Constructs a new User object with the given information.
    *
    * @param accounts     an array of accounts held by the user
    * @param invoices     an array of invoices issued to the user
    * @param loginInfo    the login information of the user
    * @param email        the email of the user
    * @param lastName     the last name of the user
    * @param firstName    the first name of the user
    * @param transactions an array of transactions associated with the user
    * @param budget       the budget of the user
    */
    public User(Account[] accounts, Invoice[] invoices,
        Login loginInfo, String email, String lastName, String firstName,
        Transaction[] transactions, Budget budget) {
<span class="fc" id="L40">        super(loginInfo, email, lastName, firstName);</span>
<span class="fc" id="L41">        this.transactions = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L43" title="All 2 branches covered.">        this.invoices = invoices != null ? Arrays.stream(invoices).collect(Collectors.toList()) : new ArrayList&lt;&gt;();</span>
<span class="fc" id="L44">        this.budget = budget;</span>
<span class="fc" id="L45">        this.accounts = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L46" title="All 2 branches covered.">        if (transactions != null) {</span>
<span class="fc" id="L47">            this.transactions.addAll(List.of(transactions));</span>
        }
<span class="fc bfc" id="L49" title="All 2 branches covered.">        if (accounts != null) {</span>
<span class="fc" id="L50">            this.accounts.addAll(List.of(accounts));</span>
        }
<span class="fc" id="L52">    }</span>

    /**
    * Gets the accounts held by the user as an array.
    *
    * @return an array of accounts held by the user
    */
    public Account[] getAccounts() {
<span class="fc" id="L60">        return this.accounts.toArray(Account[]::new);</span>
    }

    /**
    * Gets the accounts held by the user as a list.
    *
    * @return a list of accounts held by the user
    */
    public List&lt;Account&gt; getAccountsAsList() {
<span class="fc" id="L69">        return this.accounts;</span>
    }

    /**
    * Adds the given account to the accounts held by the user.
    *
    * @param account the account to be added
    */
    public void addAccount(Account account) {
<span class="nc" id="L78">        this.accounts.add(account);</span>
<span class="nc" id="L79">    }</span>

    /**
    * Gets all the invoices issued to the user.
    *
    * @return a list of all the invoices issued to the user
    */
    public List&lt;Invoice&gt; getAllInvoices() {
<span class="fc" id="L87">        return invoices;</span>
    }

    /**
    * Gets the transactions associated with the user as an array.
    *
    * @return an array of transactions associated with the user
    */
    public Transaction[] getTransactions(){
<span class="fc" id="L96">        return this.transactions.toArray(Transaction[]::new);</span>
    }

    /**
    * Gets the transactions associated with the user as a list.
    *
    * @return a list of transactions associated with the user
    */
    public List&lt;Transaction&gt; getTransactionsAsList(){
<span class="fc" id="L105">        return this.transactions;</span>
    }

    /**
    * Returns the budget of the user.
    * 
    * @return the budget of the user
    */
    public Budget getBudget(){
<span class="fc" id="L114">        return budget;</span>
    }

    /**
    * Returns the user information as a comma-separated values string.
    * 
    * @return the user information as a CSV string
    */
    public String toCSVString() {
<span class="nc" id="L123">        return this.getLoginInfo().getUserId() +</span>
<span class="nc" id="L124">                CSV_DELIMITER + this.getLoginInfo().getUserName() +</span>
<span class="nc" id="L125">                CSV_DELIMITER + this.getEmail() +</span>
<span class="nc" id="L126">                CSV_DELIMITER + this.getLoginInfo().getPassword() +</span>
<span class="nc" id="L127">                CSV_DELIMITER + this.getFirstName() +</span>
<span class="nc" id="L128">                CSV_DELIMITER + this.getLastName();</span>
    }

    /**
    * Sets the budget of the user.
    * 
    * @param newBudget the new budget of the user
    */
    public void setBudget(Budget newBudget) {
<span class="nc" id="L137">        this.budget = newBudget;</span>
<span class="nc" id="L138">    }</span>

    /**
    * Calculates and returns the total amount in all non-pension accounts of the user.
    * 
    * @return the total amount in all non-pension accounts of the user
    */
    public String amountAllAccounts() {

<span class="nc" id="L147">        return ApplicationObjects.formatCurrency(this.accounts</span>
<span class="nc" id="L148">                .stream()</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">                .filter(account -&gt; !account.getAccountType().equals(AccountCategory.PENSION_ACCOUNT))</span>
<span class="nc" id="L150">                .map(Account::getAmount)</span>
<span class="nc" id="L151">                .reduce(BigDecimal.valueOf(0), BigDecimal::add));</span>
    }

    /**
    * Calculates and returns the total expenses of the user in the last year.
    * 
    * @return the total expenses of the user in the last year
    */
    public String expensesLastYear() {
<span class="nc" id="L160">        return incomeOrExpensesLastYear(false);</span>
    }

    /**
    * Calculates and returns the total income of the user in the last year.
    * 
    * @return the total income of the user in the last year
    */
    public String incomeLastYear() {
<span class="nc" id="L169">        return incomeOrExpensesLastYear(true);</span>
    }

    /**
    * Calculates and returns the total expenses of the user in all accounts in the last 30 days.
    * 
    * @return the total expenses of the user in all accounts in the last 30 days
    */
    public String expensesLast30Days() {
<span class="nc" id="L178">        return incomeOrExpensesAllAccountsLast30Days(false);</span>
    }

    /**
    * Calculates and returns the total income of the user in all accounts in the last 30 days.
    * 
    * @return the total income of the user in all accounts in the last 30 days
    */
    public String incomeLast30Days() {
<span class="nc" id="L187">        return incomeOrExpensesAllAccountsLast30Days(true);</span>
    }

    /**
    * Checks if an account with the specified name exists in the user's accounts.
    * 
    * @param accountName the name of the account to check
    * @return true if an account with the specified name exists, false otherwise
    */
    public boolean checkIfAccountNameIsOccupied(String accountName) {
<span class="nc" id="L197">        return this.accounts.stream()</span>
<span class="nc" id="L198">                .anyMatch(account -&gt; account.getAccountName()</span>
<span class="nc" id="L199">                        .equalsIgnoreCase(accountName));</span>
    }

    /**
    * Checks if an account with the specified number exists in the user's accounts.
    * 
    * @param accountNumber the number of the account to check
    * @return true if an account with the specified number exists, false otherwise
    */
    public boolean checkIfAccountNumberIsOccupied(String accountNumber) {
<span class="nc" id="L209">        return  this.accounts.stream()</span>
<span class="nc" id="L210">                .anyMatch(account -&gt; account.getAccountNumber()</span>
<span class="nc" id="L211">                        .equalsIgnoreCase(accountNumber));</span>
    }

    /**
    * Gets the account with the specified name from the user's accounts.
    * 
    * @param accountName the name of the account to get
    * @return the account with the specified name
    * @throws NoSuchElementException if no account with the specified name exists
    */
    public Account getAccountWithAccountName(String accountName) {
<span class="nc" id="L222">        return this.accounts.stream()</span>
<span class="nc" id="L223">                .filter(account -&gt; account.getAccountName()</span>
<span class="nc" id="L224">                        .equals(accountName))</span>
<span class="nc" id="L225">                .findFirst()</span>
<span class="nc" id="L226">                .orElseThrow();</span>
    }

    /**
    * Returns the account object with the specified account number.
    *
    * @param accountNumber the account number to search for
    * @return the account object with the specified account number
    * @throws java.util.NoSuchElementException if no account with the specified account number is found
    */
    public Account getAccountWithAccountNumber(String accountNumber) {
<span class="nc" id="L237">        return this.accounts.stream()</span>
<span class="nc" id="L238">                .filter(account -&gt; account.getAccountNumber()</span>
<span class="nc" id="L239">                        .equals(accountNumber))</span>
<span class="nc" id="L240">                .findFirst()</span>
<span class="nc" id="L241">                .orElseThrow();</span>
    }

    /**
    * Removes the specified account from the list of accounts.
    *
    * @param account the account to remove
    */
    public void removeAccount(Account account){
<span class="nc" id="L250">        this.accounts.remove(account);</span>
<span class="nc" id="L251">    }</span>

    /**
    * Adds the specified transaction to the list of transactions.
    *
    * @param transaction the transaction to add
    */
    public void addTransaction(Transaction transaction) {
<span class="nc" id="L259">        this.transactions.add(transaction);</span>
<span class="nc" id="L260">    }</span>

    /**
    * Returns the total income or expenses of all accounts in the last 30 days, depending on the value of the parameter.
    *
    * @param incomeOrExpenses true to return total income, false to return total expenses
    * @return a string representation of the total income or expenses
    */
    private String incomeOrExpensesAllAccountsLast30Days(boolean incomeOrExpenses) {
<span class="nc" id="L269">        Supplier&lt;Stream&lt;String&gt;&gt; accountNumbers = () -&gt; accounts</span>
<span class="nc" id="L270">                .stream()</span>
<span class="nc" id="L271">                .map(Account::getAccountNumber);</span>

<span class="nc" id="L273">        return ApplicationObjects.formatCurrency(this.transactions</span>
<span class="nc" id="L274">                .stream()</span>
<span class="nc" id="L275">                .filter(transaction -&gt;</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">                        incomeOrExpenses ? accountNumbers.get()</span>
<span class="nc" id="L277">                                .anyMatch(accountNumber -&gt; accountNumber.equals(transaction.getToAccountNumber()))</span>
<span class="nc" id="L278">                                : accountNumbers.get().anyMatch(accountNumber -&gt; accountNumber.equals(transaction.getFromAccountNumber())))</span>
<span class="nc" id="L279">                .filter(transaction -&gt;</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">                        transaction.getDateOfTransaction().isAfter(LocalDate.now().minusDays(30))</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">                                &amp;&amp; transaction.getDateOfTransaction().isBefore(LocalDate.now().plusDays(1)))</span>
<span class="nc" id="L282">                .map(Transaction::getAmount)</span>
<span class="nc" id="L283">                .reduce(BigDecimal.valueOf(0), BigDecimal::add));</span>
    }

    /**
    * Returns the total income or expenses of all accounts in the last year, depending on the value of the parameter.
    *
    * @param incomeOrExpenses true to return total income, false to return total expenses
    * @return a string representation of the total income or expenses
    */
    private String incomeOrExpensesLastYear(boolean incomeOrExpenses) {
<span class="nc" id="L293">        LocalDate startOfLastYear = LocalDate.ofYearDay(LocalDate.now().getYear() - 1, 1);</span>
<span class="nc" id="L294">        LocalDate endOfLastYear = LocalDate.ofYearDay(LocalDate.now().getYear() - 1, 365);</span>
<span class="nc" id="L295">        Supplier&lt;Stream&lt;String&gt;&gt; accountNumbers = () -&gt; accounts</span>
<span class="nc" id="L296">                .stream()</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">                .filter(account -&gt; !account.getAccountType().equals(AccountCategory.PENSION_ACCOUNT))</span>
<span class="nc" id="L298">                .map(Account::getAccountNumber);</span>

<span class="nc" id="L300">        return ApplicationObjects.formatCurrency(this.transactions</span>
<span class="nc" id="L301">                .stream()</span>
<span class="nc" id="L302">                .filter(transaction -&gt;</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">                        incomeOrExpenses ? accountNumbers.get()</span>
<span class="nc" id="L304">                                .anyMatch(accountNumber -&gt; accountNumber.equals(transaction.getToAccountNumber()))</span>
<span class="nc" id="L305">                                : accountNumbers.get().anyMatch(accountNumber -&gt; accountNumber.equals(transaction.getFromAccountNumber())))</span>
<span class="nc" id="L306">                .filter(transaction -&gt;</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">                        transaction.getDateOfTransaction().isAfter(startOfLastYear)</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">                                &amp;&amp; transaction.getDateOfTransaction().isBefore(endOfLastYear))</span>
<span class="nc" id="L309">                .map(Transaction::getAmount)</span>
<span class="nc" id="L310">                .reduce(BigDecimal.valueOf(0), BigDecimal::add));</span>

    }

    /**
    * Returns the total expenses of the specified budget category in the last 30 days.
    *
    * @param category the budget category to get the total expenses for
    * @return the total expenses of the specified budget category in the last 30 days
    */
    public double getTotalExpenseOfCategoryLast30Days(String category) {
<span class="nc" id="L321">        return getTotalExpenseOrIncomeOfCategoryLast30Days(category);</span>
    }

    /**
    * Returns the total income of the specified budget category in the last 30 days.
    *
    * @param category the budget category to get the total income for
    * @return the total income of the specified budget category in the last 30 days
    */
    public double getTotalIncomeOfCategoryLast30Days(String category) {
<span class="nc" id="L331">        return getTotalExpenseOrIncomeOfCategoryLast30Days(category);</span>
    }

    /**
    * Returns the total expenses of the specified budget category in the last 30 days.
    *
    * @param category the budget category to get the total expenses for
    * @return the total expenses of the specified budget category in the last 30 days
    */
    private double getTotalExpenseOrIncomeOfCategoryLast30Days(String category) {
<span class="nc" id="L341">        return getTransactionsAsList().stream()</span>
<span class="nc" id="L342">                .filter(transaction -&gt;</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">                        transaction.getDateOfTransaction().isAfter(LocalDate.now().minusDays(30))</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">                                &amp;&amp; transaction.getDateOfTransaction().isBefore(LocalDate.now().plusDays(1)))</span>
<span class="nc" id="L345">                .filter(transaction -&gt; transaction.getCategory()</span>
<span class="nc" id="L346">                .equals(BudgetCategory.valueOf(category</span>
<span class="nc" id="L347">                        .replaceAll(&quot; &quot;, &quot;_&quot;)</span>
<span class="nc" id="L348">                        .toUpperCase())))</span>
<span class="nc" id="L349">                .map(Transaction::getAmount).reduce(new BigDecimal(0), BigDecimal::add).doubleValue();</span>
    }

    /**
    * Returns the total expenses of the specified budget category in the last year.
    *
    * @param category the budget category to get the total expenses for
    * @return the total expenses of the specified budget category in the last year
    */
    public double getTotalExpenseOfCategoryLastYear(String category) {
<span class="nc" id="L359">        return getTotalExpenseOrIncomeOfCategoryLastYear(category, true);</span>
    }

    /**
    * Returns the total income of the specified budget category in the last year.
    *
    * @param category the budget category to get the total income for
    * @return the total income of the specified budget category in the last year
    */
    public double getTotalIncomeOfCategoryLastYear(String category) {
<span class="nc" id="L369">        return getTotalExpenseOrIncomeOfCategoryLastYear(category, false);</span>
    }

    /**
    * Calculates the total expenses or income for a specific budget category for the last calendar year.
    * 
    * @param category the name of the budget category to calculate expenses or income for
    * @param expenseOrIncome a boolean indicating whether to calculate expenses (true) or income (false)
    * @return the total amount of expenses or income for the given category over the last calendar year
    */
    private double getTotalExpenseOrIncomeOfCategoryLastYear(String category, boolean expenseOrIncome) {
<span class="nc" id="L380">        LocalDate startOfLastYear = LocalDate.ofYearDay(LocalDate.now().getYear() - 1, 1);</span>
<span class="nc" id="L381">        LocalDate endOfLastYear = LocalDate.ofYearDay(LocalDate.now().getYear() - 1, 365);</span>

<span class="nc bnc" id="L383" title="All 2 branches missed.">        if (startOfLastYear.isLeapYear()) {</span>
<span class="nc" id="L384">            endOfLastYear = LocalDate.ofYearDay(LocalDate.now().getYear() - 1, 366);</span>
        }
<span class="nc" id="L386">        LocalDate finalEndOfLastYear = endOfLastYear;</span>

<span class="nc" id="L388">        return getTransactionsAsList().stream()</span>
<span class="nc" id="L389">                .filter(transaction -&gt;</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">                        transaction.getDateOfTransaction().isAfter(startOfLastYear)</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">                                &amp;&amp; transaction.getDateOfTransaction().isBefore(finalEndOfLastYear))</span>
<span class="nc" id="L392">                .filter(transaction -&gt; transaction.getCategory()</span>
<span class="nc" id="L393">                        .equals(BudgetCategory.valueOf(category</span>
<span class="nc" id="L394">                                .replaceAll(&quot; &quot;, &quot;_&quot;)</span>
<span class="nc" id="L395">                                .toUpperCase())))</span>
<span class="nc" id="L396">                .map(Transaction::getAmount).reduce(new BigDecimal(0), BigDecimal::add).doubleValue();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>
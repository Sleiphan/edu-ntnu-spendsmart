<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ManageUserChangePasswordScene.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">demo</a> &gt; <a href="index.source.html" class="el_package">edu.ntnu.g14.frontend</a> &gt; <span class="el_source">ManageUserChangePasswordScene.java</span></div><h1>ManageUserChangePasswordScene.java</h1><pre class="source lang-java linenums">package edu.ntnu.g14.frontend;

import java.io.FileNotFoundException;
import java.io.IOException;

import edu.ntnu.g14.BankApplication;
import edu.ntnu.g14.FileManagement;
import edu.ntnu.g14.User;
import javafx.geometry.Pos;
import javafx.scene.Group;
import javafx.scene.Scene;
import javafx.scene.control.*;
import javafx.scene.image.ImageView;
import javafx.scene.input.MouseEvent;
import javafx.scene.layout.VBox;
import javafx.scene.text.Text;
import javafx.stage.Stage;
/**
 * This class represents the user management change password scene, where a user can change their password.
 * It contains methods for creating and displaying the scene, and handling the user's input.
 */
<span class="nc" id="L22">public class ManageUserChangePasswordScene {</span>
<span class="nc" id="L23">    static Stage stage = BankApplication.getStage();</span>
<span class="nc" id="L24">    private static final User loggedInUser = BankApplication.loggedInUser;</span>
    /**
     * Creates and returns a Scene object for changing the password of a user.
     *
     * @return the Scene object for changing the user's password
     * @throws FileNotFoundException if the file is not found
     * @throws IOException if an I/O exception occurs
     */

    static public Scene scene() throws FileNotFoundException, IOException{
<span class="nc" id="L34">        Label loggedInUserLabel = new Label(loggedInUser.getLoginInfo().getUserName());</span>
<span class="nc" id="L35">        loggedInUserLabel.setStyle(&quot;-fx-font-size: 40;&quot;);</span>
<span class="nc" id="L36">        Label loggedInUserEmail = new Label(loggedInUser.getEmail());</span>
<span class="nc" id="L37">        loggedInUserEmail.setStyle(&quot;-fx-font-size: 20;&quot;);</span>

<span class="nc" id="L39">        VBox userInfoBox = new VBox(5, loggedInUserLabel, loggedInUserEmail);</span>
<span class="nc" id="L40">        userInfoBox.setAlignment(Pos.CENTER);</span>
<span class="nc" id="L41">        userInfoBox.setLayoutX(220);</span>
<span class="nc" id="L42">        userInfoBox.setLayoutY(75);</span>

<span class="nc" id="L44">        Button cancelButton = ApplicationObjects.newButton(&quot;Cancel&quot;, 594-329, 399-136, 159, 61, 16);</span>
<span class="nc" id="L45">        Button confirmButton = ApplicationObjects.newButton(&quot;Confirm&quot;, 761-329, 399-136, 159, 61, 16);</span>
<span class="nc" id="L46">        Text oldPassword = ApplicationObjects.newText(&quot;Enter old password&quot;, 16, false, 446-329, 494-136);</span>
<span class="nc" id="L47">        Text newPassword = ApplicationObjects.newText(&quot;Enter new password&quot;, 16, false, 438-329, 528-136);</span>
<span class="nc" id="L48">        Text reNewPassword = ApplicationObjects.newText(&quot;Re-enter new password&quot;, 16, false, 413-329, 562-136);</span>
<span class="nc" id="L49">        TextField oldPasswordField = ApplicationObjects.newTextField(&quot;&quot;, 594-329, 476-136, 326, 30, 0);</span>
<span class="nc" id="L50">        TextField newPasswordField = ApplicationObjects.newTextField(&quot;&quot;, 594-329, 510-136, 326, 30, 0);</span>
<span class="nc" id="L51">        TextField reNewPasswordField = ApplicationObjects.newTextField(&quot;&quot;, 594-329, 544-136, 326, 30, 0);</span>

        // Show an error message to the user, e.g., a dialog box, saying the old password is incorrect
<span class="nc" id="L54">        confirmButton.setOnAction(event -&gt; {</span>
<span class="nc" id="L55">            String oldPasswordInput = oldPasswordField.getText();</span>
<span class="nc" id="L56">            String newPasswordInput = newPasswordField.getText();</span>
<span class="nc" id="L57">            String reNewPasswordInput = reNewPasswordField.getText();</span>

<span class="nc bnc" id="L59" title="All 2 branches missed.">            if (verifyOldPassword(oldPasswordInput)) {</span>
<span class="nc" id="L60">                Alert alert = new Alert(Alert.AlertType.CONFIRMATION);</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">                if (newPasswordInput.equals(reNewPasswordInput)) {</span>
<span class="nc" id="L62">                    alert.setTitle(&quot;Confirm Password Change&quot;);</span>
<span class="nc" id="L63">                    alert.setHeaderText(&quot;Are you sure you want to change the Password to: &quot; + newPasswordField.getText() + &quot;?&quot;);</span>
<span class="nc" id="L64">                    alert.showAndWait().ifPresent(response -&gt; {</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">                                if (response == ButtonType.OK) {</span>
<span class="nc" id="L66">                                    updatePassword(newPasswordInput);</span>
                                }
<span class="nc" id="L68">                            });</span>
                    // Show a success message to the user, e.g., a dialog box
                } else {
<span class="nc" id="L71">                    alert.setTitle(&quot;Try Again&quot;);</span>
<span class="nc" id="L72">                    alert.setHeaderText(&quot;The you have to enter the new password twice&quot;);</span>
<span class="nc" id="L73">                    alert.setContentText(newPasswordInput +&quot; is not the same as: &quot; + reNewPasswordInput);</span>
<span class="nc" id="L74">                    alert.showAndWait();</span>
                    }
                    // Show an error message to the user, e.g., a dialog box, saying the new passwords do not match
                }
            try {
<span class="nc" id="L79">                stage.setScene(UserManagementScene.scene());</span>
<span class="nc" id="L80">            } catch (IOException e) {</span>
<span class="nc" id="L81">                throw new RuntimeException(e);</span>
<span class="nc" id="L82">            }</span>
<span class="nc" id="L83">            });</span>

<span class="nc" id="L85">        ImageView homeButton = ApplicationObjects.newImage(&quot;home.png&quot;, 10, 10, 20, 20);</span>
<span class="nc" id="L86">        homeButton.setOnMouseClicked(e -&gt; {</span>
            try {
<span class="nc" id="L88">                stage.setScene(MainPageScene.scene());</span>
<span class="nc" id="L89">            } catch (IOException e1) {</span>
<span class="nc" id="L90">                e1.printStackTrace();</span>
<span class="nc" id="L91">            }</span>
<span class="nc" id="L92">        });</span>
<span class="nc" id="L93">        Button dropDownButton = ApplicationObjects.newButton(&quot;test&quot;, 676, 10, 10, 10, 10);</span>
<span class="nc" id="L94">        Group dropDown = ApplicationObjects.dropDownMenu();</span>
<span class="nc" id="L95">        ImageView manageUserButton = ApplicationObjects.newImage(&quot;user.png&quot;, 646, 10, 20, 20);</span>
<span class="nc" id="L96">        Group root = new Group(userInfoBox, cancelButton, confirmButton,</span>
        oldPassword, newPassword, reNewPassword, oldPasswordField,
        newPasswordField, reNewPasswordField, dropDownButton, homeButton, manageUserButton);
<span class="nc" id="L99">        dropDownButton.setOnAction(e -&gt; root.getChildren().add(dropDown));</span>
<span class="nc" id="L100">        root.getStylesheets().add(&quot;StyleSheet.css&quot;); </span>
<span class="nc" id="L101">        Scene scene = new Scene(root, 728, 567, ApplicationObjects.getSceneColor());</span>
       
        
<span class="nc" id="L104">        Group userButtons = ApplicationObjects.userMenu();</span>
<span class="nc" id="L105">        manageUserButton.addEventHandler(MouseEvent.MOUSE_CLICKED, event -&gt; {</span>
<span class="nc" id="L106">            root.getChildren().add(userButtons);</span>
<span class="nc" id="L107">            event.consume();</span>
<span class="nc" id="L108">        });</span>
<span class="nc" id="L109">        scene.setOnMouseClicked(e -&gt; {</span>
<span class="nc" id="L110">            root.getChildren().remove(userButtons);</span>
<span class="nc" id="L111">            root.getChildren().remove(dropDown);</span>
<span class="nc" id="L112">        });</span>
        
<span class="nc" id="L114">        return scene;</span>
    }

    /**
     * Verifies the old password by checking if the
     * currentPassword, is equal to the oldPasswordInput
     *
     * @param oldPasswordInput the old password entered by user
     * @return true if equal, fasle if not
     */
    private static boolean verifyOldPassword(String oldPasswordInput) {
<span class="nc" id="L125">        String currentPassword = loggedInUser.getLoginInfo().getPassword();</span>
<span class="nc" id="L126">        return oldPasswordInput.equals(currentPassword);</span>
    }

    /**
     * Sets the newPassword to loggedInUser, and writes to file management.
     *
     * @param newPassword new password entered by User
     */
    private static void updatePassword(String newPassword) {
<span class="nc" id="L135">        loggedInUser.getLoginInfo().setPassword(newPassword);</span>
<span class="nc" id="L136">        FileManagement.newEditUser(loggedInUser);</span>
        // Save the updated user data to the database or storage system
<span class="nc" id="L138">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InvoiceDAO.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">demo</a> &gt; <a href="index.source.html" class="el_package">edu.ntnu.g14.dao</a> &gt; <span class="el_source">InvoiceDAO.java</span></div><h1>InvoiceDAO.java</h1><pre class="source lang-java linenums">package edu.ntnu.g14.dao;

import edu.ntnu.g14.Invoice;

import java.io.*;
import java.nio.charset.Charset;
import java.util.Arrays;

/**
 * A class that provides methods for interacting with a file to store and retrieve invoice data.
 */
public class InvoiceDAO {

    private final Charset charset;
    private final IndexedDataFile file;

    /**
    * Constructs an InvoiceDAO object with the specified file path using the default character set.
    *
    * @param filePath the path of the file where invoice data is stored
    * @throws IOException if an I/O error occurs
    */
    public InvoiceDAO(String filePath) throws IOException {
<span class="nc" id="L24">        this(filePath, Charset.defaultCharset());</span>
<span class="nc" id="L25">    }</span>

    /**
    * Constructs an InvoiceDAO object with the specified file path and character set.
    *
    * @param filePath the path of the file where invoice data is stored
    * @param charset  the character set used to encode and decode the data
    * @throws IOException if an I/O error occurs
    */
<span class="nc" id="L34">    public InvoiceDAO(String filePath, Charset charset) throws IOException {</span>
<span class="nc" id="L35">        this.file = new IndexedDataFile(filePath, charset);</span>
<span class="nc" id="L36">        this.charset = charset;</span>
<span class="nc" id="L37">    }</span>

    /**
    * Adds a new invoice for the specified user to the data file.
    *
    * @param userID the ID of the user
    * @param invoice the invoice to add
    * @return true if the invoice was added successfully, false otherwise
    */
    public boolean addNewInvoice(String userID, Invoice budget) {
        try {
<span class="nc" id="L48">            file.addNewData(userID, budget.toCSVString().getBytes(charset));</span>
<span class="nc" id="L49">        } catch (IOException e) {</span>
<span class="nc" id="L50">            return false;</span>
<span class="nc" id="L51">        }</span>

<span class="nc" id="L53">        return true;</span>
    }

    /**
    * Deletes the specified invoice for the specified user from the data file.
    *
    * @param userID the ID of the user
    * @param invoiceIndex the index of the invoice to delete
    * @return true if the invoice was deleted successfully, false otherwise
    */
    public boolean deleteInvoice(String userID, int invoiceIndex) {
        try {
<span class="nc" id="L65">            file.deleteData(userID, invoiceIndex);</span>
<span class="nc" id="L66">        } catch (IOException e) {</span>
<span class="nc" id="L67">            return false;</span>
<span class="nc" id="L68">        }</span>

<span class="nc" id="L70">        return true;</span>
    }

    /**
    * Retrieves the specified invoice for the specified user from the data file.
    *
    * @param userID the ID of the user
    * @param invoiceIndex the index of the invoice to retrieve
    * @return the retrieved invoice, or null if the invoice could not be retrieved
    */
    public Invoice getInvoice(String userID, int invoiceIndex) {
        byte[] data;
        try {
<span class="nc" id="L83">            data = file.getData(userID, invoiceIndex);</span>
<span class="nc" id="L84">        } catch (IOException e) {</span>
<span class="nc" id="L85">            return null;</span>
<span class="nc" id="L86">        }</span>

<span class="nc" id="L88">        String csvString = new String(data, charset);</span>
<span class="nc" id="L89">        return Invoice.fromCSVString(csvString);</span>
    }

    /**
    * Retrieves all invoices for the specified user from the data file.
    *
    * @param userID the ID of the user
    * @return an array of all invoices for the specified user, or null if the invoices could not be retrieved
    */
    public Invoice[] getAllInvoices(String userID) {
        byte[][] data;

        try {
<span class="nc" id="L102">            data = file.readAllInIdentifier(userID);</span>
<span class="nc" id="L103">        } catch (IOException e) {</span>
<span class="nc" id="L104">            return null;</span>
<span class="nc" id="L105">        }</span>

<span class="nc bnc" id="L107" title="All 2 branches missed.">        if (data == null)</span>
<span class="nc" id="L108">            return null;</span>

<span class="nc" id="L110">        return Arrays.stream(data)</span>
<span class="nc" id="L111">                .map(b -&gt; new String(b, charset))</span>
<span class="nc" id="L112">                .map(Invoice::fromCSVString)</span>
<span class="nc" id="L113">                .toArray(Invoice[]::new);</span>
    }

    /**
     * Deletes all invoices associated with the specified user from the data file.
     * @param userID the identifier of the user whose transactions should be deleted
     * @throws IOException if an I/O error occurs while attempting to delete the transactions
     */
    public void deleteUser(String userID) throws IOException {
<span class="nc" id="L122">        file.deleteIdentifier(userID);</span>
<span class="nc" id="L123">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>
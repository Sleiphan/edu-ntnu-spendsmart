<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AccountOverviewScene.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">demo</a> &gt; <a href="index.source.html" class="el_package">edu.ntnu.g14.frontend</a> &gt; <span class="el_source">AccountOverviewScene.java</span></div><h1>AccountOverviewScene.java</h1><pre class="source lang-java linenums">package edu.ntnu.g14.frontend;

import java.io.IOException;
import java.util.List;
import java.util.NoSuchElementException;
import java.util.Optional;
import java.util.stream.Collectors;

import edu.ntnu.g14.*;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.EventHandler;
import javafx.scene.Group;
import javafx.scene.Scene;
import javafx.scene.control.*;
import javafx.scene.image.ImageView;
import javafx.scene.input.MouseEvent;
import javafx.scene.text.Text;
import javafx.stage.Stage;

<span class="nc" id="L21">public class AccountOverviewScene {</span>
<span class="nc" id="L22">    static Stage stage = BankApplication.getStage();</span>
    private static Account currentAccount;
    private static TableView&lt;ObservableList&lt;Object&gt;&gt; lastTransactionsTable;
    private static ObservableList&lt;ObservableList&lt;Object&gt;&gt; lastTransactionsData;
    private static Text amountText;
    private static Text accountNumberText;

    static public Scene scene(Optional&lt;Account&gt; account) throws IOException {
<span class="nc" id="L30">        List&lt;Account&gt; accounts = BankApplication.loggedInUser.getAccountsAsList();</span>
<span class="nc" id="L31">        ObservableList&lt;String&gt; accountNames = FXCollections.observableArrayList(getAccountsNames());</span>

<span class="nc" id="L33">        String[] columnTitlesTransactionsTable = {&quot;Transaction&quot;, &quot;Date&quot;, &quot;Amount&quot;};</span>


<span class="nc" id="L36">        ComboBox&lt;String&gt; accountComboBox = ApplicationObjects.newComboBox(columnTitlesTransactionsTable, 364, 30, 30, 364-(364/2), 50);</span>
<span class="nc" id="L37">        accountComboBox.setItems(accountNames);</span>
<span class="nc" id="L38">        accountComboBox.setValue(accounts.get(0).getAccountName());</span>
<span class="nc" id="L39">        accountNumberText    = ApplicationObjects.newText(&quot;Account Number: &quot; + accounts.get(0).getAccountNumber(), 14, false, 0, 130);</span>
<span class="nc" id="L40">        amountText = ApplicationObjects.newText(&quot;Balance: &quot; + ApplicationObjects.formatCurrency(accounts.get(0).getAmount()), 20, false, 0, 160);</span>
<span class="nc" id="L41">        Button addExpense         = ApplicationObjects.newButton(&quot;Add Expense&quot;, 30,80, 100, 20,14);</span>
<span class="nc" id="L42">        Button addIncome          = ApplicationObjects.newButton(&quot;Add Income&quot;, 30,50, 100, 20,14);</span>
<span class="nc" id="L43">        Button addAccount         = ApplicationObjects.newButton(&quot;Add Account&quot;, 728 - 130, 50, 100, 20, 14);</span>
<span class="nc" id="L44">        Button editAccount        = ApplicationObjects.newButton(&quot;Edit Account&quot;, 728 - 130, 80, 100, 20, 14);</span>
<span class="nc" id="L45">        Text lastTransactionsText = ApplicationObjects.newText(&quot;Last Transactions:&quot;, 24, false, 20, 200);</span>
<span class="nc bnc" id="L46" title="All 4 branches missed.">        if (account != null &amp;&amp; account.isPresent()) {</span>
<span class="nc" id="L47">            accountComboBox.setValue(account.get().getAccountName());</span>
<span class="nc" id="L48">            setAccountNumberAndAmountText();</span>

        }
<span class="nc" id="L51">        amountText.setLayoutX((double) 728/2 - amountText.getLayoutBounds().getWidth()/2);</span>
<span class="nc" id="L52">        accountNumberText.setLayoutX((double) 728/2 - accountNumberText.getLayoutBounds().getWidth()/2);</span>
<span class="nc" id="L53">        lastTransactionsTable = ApplicationObjects.newTableView1(columnTitlesTransactionsTable, 20, 230, 688, 300, BankApplication.loggedInUser.getAccountsAsList().stream().map(Account::getAccountNumber).collect(Collectors.toList()));</span>
<span class="nc" id="L54">        lastTransactionsTable.setColumnResizePolicy(TableView.CONSTRAINED_RESIZE_POLICY);</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">        if (accountComboBox.getValue() != null) {</span>
<span class="nc" id="L56">            setCurrentAccount(accountComboBox.getValue());</span>
        }
<span class="nc" id="L58">        ObservableList&lt;ObservableList&lt;Object&gt;&gt; lastTransactionsData = initializeLastTransactionsData(currentAccount);</span>
<span class="nc" id="L59">        lastTransactionsTable.setItems(lastTransactionsData);</span>

<span class="nc" id="L61">        accountComboBox.setOnAction(actionEvent -&gt; {</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">            if (accountComboBox.getValue() != null) {</span>
<span class="nc" id="L63">                setCurrentAccount(accountComboBox.getValue());</span>

<span class="nc" id="L65">                accountNumberText.setText(&quot;Account Number: &quot; + currentAccount.getAccountNumber());</span>
<span class="nc" id="L66">                amountText.setText(&quot;Balance: &quot; + ApplicationObjects.formatCurrency(currentAccount.getAmount()));</span>

            }
<span class="nc" id="L69">        });</span>

<span class="nc" id="L71">        addAccount.setOnAction(actionEvent -&gt; {</span>
<span class="nc" id="L72">            Dialog&lt;Account.AccountBuilder&gt; accountBuilderDialog = new AccountDialog(new Account.AccountBuilder());</span>
<span class="nc" id="L73">            Optional&lt;Account.AccountBuilder&gt; result = accountBuilderDialog.showAndWait();</span>
<span class="nc" id="L74">            result.ifPresent(accountBuilder -&gt; addAndWriteAccount(accountNames, accountBuilder));</span>
<span class="nc" id="L75">        });</span>
<span class="nc" id="L76">        editAccount.setOnAction(actionEvent -&gt; {</span>
<span class="nc" id="L77">            Dialog&lt;Account&gt; accountDialog = new EditAccountDialog(currentAccount);</span>
<span class="nc" id="L78">            Optional&lt;Account&gt; result = accountDialog.showAndWait();</span>

<span class="nc bnc" id="L80" title="All 2 branches missed.">            if (result.isPresent()) {</span>

<span class="nc" id="L82">                accountComboBox.setItems(FXCollections.observableArrayList(getAccountsNames()));</span>

<span class="nc bnc" id="L84" title="All 2 branches missed.">                if (!BankApplication.loggedInUser.getAccountsAsList().contains(currentAccount)) {</span>
<span class="nc" id="L85">                    getAccountsNames().remove(currentAccount.getAccountName());</span>
<span class="nc" id="L86">                    accountComboBox.setItems(FXCollections.observableArrayList(getAccountsNames()));</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">                    if (accountNames.size() != 0)</span>
<span class="nc" id="L88">                        accountComboBox.setValue(getAccountsNames().get(0));</span>
                } else {
<span class="nc" id="L90">                    accountComboBox.setValue(currentAccount.getAccountName());</span>
                }
<span class="nc" id="L92">                FileManagement.editAccount(BankApplication.loggedInUser.getLoginInfo().getUserId(), currentAccount);</span>
            }
<span class="nc" id="L94">        });</span>

<span class="nc" id="L96">        addExpense.setOnAction(actionEvent -&gt; showTransactionDialog(false));</span>

<span class="nc" id="L98">        addIncome.setOnAction(actionEvent -&gt; showTransactionDialog(true));</span>



<span class="nc" id="L102">        ImageView homeButton = ApplicationObjects.newImage(&quot;home.png&quot;, 10, 10, 20, 20);</span>
<span class="nc" id="L103">        homeButton.setOnMouseClicked(e -&gt; {</span>
            try {
<span class="nc" id="L105">                stage.setScene(MainPageScene.scene());</span>
<span class="nc" id="L106">            } catch (IOException e1) {</span>
<span class="nc" id="L107">                e1.printStackTrace();</span>
<span class="nc" id="L108">            }</span>
<span class="nc" id="L109">        });</span>
        
<span class="nc" id="L111">        Button dropDownButton = ApplicationObjects.newButton(&quot;test&quot;, 676, 10, 10, 10, 10);</span>
<span class="nc" id="L112">        Group dropDown = ApplicationObjects.dropDownMenu();</span>
<span class="nc" id="L113">        ImageView manageUserButton = ApplicationObjects.newImage(&quot;user.png&quot;, 646, 10, 20, 20);</span>
<span class="nc" id="L114">        Group root = new Group(accountComboBox, accountNumberText, amountText, addIncome, addExpense, addAccount, editAccount, lastTransactionsText, lastTransactionsTable, dropDownButton, homeButton, manageUserButton);</span>
<span class="nc" id="L115">        dropDownButton.setOnAction(e -&gt; root.getChildren().add(dropDown));</span>

<span class="nc" id="L117">        root.getStylesheets().add(&quot;StyleSheet.css&quot;);</span>
<span class="nc" id="L118">        Scene scene = new Scene(root, 728, 567, ApplicationObjects.getSceneColor());</span>
        

        
<span class="nc" id="L122">        Group userButtons = ApplicationObjects.userMenu();</span>
<span class="nc" id="L123">        manageUserButton.addEventHandler(MouseEvent.MOUSE_CLICKED, new EventHandler&lt;MouseEvent&gt;() {</span>
            @Override
            public void handle(MouseEvent event){
<span class="nc" id="L126">                root.getChildren().add(userButtons);</span>
<span class="nc" id="L127">                event.consume();</span>
<span class="nc" id="L128">            }</span>
        });  
        

<span class="nc" id="L132">        return scene;</span>
    }

    private static void addAndWriteAccount(ObservableList&lt;String&gt; accountNames, Account.AccountBuilder result) {
<span class="nc" id="L136">        Account account = result.build();</span>
<span class="nc" id="L137">        FileManagement.writeAccount(BankApplication.loggedInUser.getLoginInfo().getUserId(), account);</span>
<span class="nc" id="L138">        accountNames.add(account.getAccountName());</span>
<span class="nc" id="L139">        BankApplication.loggedInUser.addAccount(account);</span>
<span class="nc" id="L140">    }</span>

    private static void setCurrentAccount(String accountName) {
        try {
<span class="nc" id="L144">            currentAccount = BankApplication.loggedInUser.getAccountWithAccountName(accountName);</span>
<span class="nc" id="L145">        } catch (NoSuchElementException e) {</span>
<span class="nc" id="L146">            Account accountWithOldAccountName = currentAccount;</span>
<span class="nc" id="L147">            currentAccount = BankApplication.loggedInUser.getAccountWithAccountNumber(accountWithOldAccountName</span>
<span class="nc" id="L148">                    .getAccountNumber());</span>
<span class="nc" id="L149">        }</span>
<span class="nc" id="L150">        initializeLastTransactionsData(currentAccount);</span>
<span class="nc" id="L151">        lastTransactionsTable.setItems(lastTransactionsData);</span>

<span class="nc" id="L153">    }</span>
    private static List&lt;String&gt; getAccountsNames() {

<span class="nc" id="L156">        return BankApplication.loggedInUser.getAccountsAsList()</span>
<span class="nc" id="L157">                .stream().map(Account::getAccountName).collect(Collectors.toList());</span>
    }
    private static ObservableList&lt;ObservableList&lt;Object&gt;&gt; initializeLastTransactionsData(Account account) {

<span class="nc" id="L161">        List&lt;Transaction&gt; transactionsOfAccount = BankApplication.loggedInUser.getTransactionsAsList().stream()</span>
<span class="nc" id="L162">                .filter(transaction -&gt; transaction.getToAccountNumber()</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">                .equals(account.getAccountNumber())</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">                        || transaction.getFromAccountNumber().equals(account.getAccountNumber()))</span>
<span class="nc" id="L165">                .collect(Collectors.toList());</span>

<span class="nc" id="L167">        lastTransactionsData = FXCollections.observableArrayList();</span>

<span class="nc" id="L169">        transactionsOfAccount.forEach(transaction -&gt; {</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">            if (transaction.getFromAccountNumber().equals(account.getAccountNumber())) {</span>
<span class="nc" id="L171">                lastTransactionsData.</span>
<span class="nc" id="L172">                        add(FXCollections.observableArrayList(transaction.getToAccountNumber(),</span>
<span class="nc" id="L173">                                transaction.getDateOfTransaction().format(ApplicationObjects.dateFormatter),</span>
<span class="nc" id="L174">                                ApplicationObjects.formatCurrency(transaction.getAmount())));</span>
            } else {
<span class="nc" id="L176">                lastTransactionsData.add(FXCollections.observableArrayList(transaction.getFromAccountNumber(),</span>
<span class="nc" id="L177">                        transaction.getDateOfTransaction().format(ApplicationObjects.dateFormatter),</span>
<span class="nc" id="L178">                        ApplicationObjects.formatCurrency(transaction.getAmount())));</span>
            }
<span class="nc" id="L180">            });</span>

<span class="nc" id="L182">        return lastTransactionsData;</span>
    }

    private static void addTransaction(Transaction transaction) {
<span class="nc bnc" id="L186" title="All 2 branches missed.">        if (transaction.getFromAccountNumber().equals(currentAccount.getAccountNumber())) {</span>
<span class="nc" id="L187">            lastTransactionsData.</span>
<span class="nc" id="L188">                    add(FXCollections.observableArrayList(transaction.getToAccountNumber(),</span>
<span class="nc" id="L189">                            transaction.getDateOfTransaction().format(ApplicationObjects.dateFormatter),</span>
<span class="nc" id="L190">                            transaction.getAmount()));</span>
        } else {
<span class="nc" id="L192">            lastTransactionsData.add(FXCollections.observableArrayList(transaction.getFromAccountNumber(),</span>
<span class="nc" id="L193">                    transaction.getDateOfTransaction().format(ApplicationObjects.dateFormatter),</span>
<span class="nc" id="L194">                    transaction.getAmount()));</span>
        }
<span class="nc" id="L196">    }</span>
    private static void showTransactionDialog(boolean incomeOrExpense) {
<span class="nc" id="L198">        Dialog&lt;Transaction.TransactionBuilder&gt; transactionBuilderDialog =</span>
                new TransactionDialog(new Transaction.TransactionBuilder(), incomeOrExpense);
<span class="nc" id="L200">        Optional&lt;Transaction.TransactionBuilder&gt; result = transactionBuilderDialog.showAndWait();</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (result.isPresent()) {</span>
<span class="nc" id="L202">            Transaction transaction = result.get().build();</span>

<span class="nc" id="L204">            FileManagement.writeTransaction(BankApplication.loggedInUser.getLoginInfo().getUserId(), transaction);</span>
<span class="nc" id="L205">            BankApplication.loggedInUser.addTransaction(transaction);</span>
<span class="nc" id="L206">            addTransaction(transaction);</span>
        }
<span class="nc" id="L208">    }</span>
    private static void setAccountNumberAndAmountText() {
<span class="nc" id="L210">        accountNumberText.setText(&quot;Account Number: &quot; + currentAccount.getAccountNumber());</span>
<span class="nc" id="L211">        amountText.setText(&quot;Balance: &quot; + ApplicationObjects.formatCurrency(currentAccount.getAmount()));</span>
<span class="nc" id="L212">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>
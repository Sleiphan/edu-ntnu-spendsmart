<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FileManagement.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">demo</a> &gt; <a href="index.source.html" class="el_package">edu.ntnu.g14</a> &gt; <span class="el_source">FileManagement.java</span></div><h1>FileManagement.java</h1><pre class="source lang-java linenums">package edu.ntnu.g14;


import java.io.*;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
import java.nio.file.FileAlreadyExistsException;
import java.nio.file.Files;
import java.nio.file.Path;
import edu.ntnu.g14.dao.*;

/**
 * The class is responsible for handling file I/O for the application.
 * It provides methods for reading and writing data to text files.
 * The class ensures the necessary save files are created if they do not exist.
 */
<span class="nc" id="L17">public class FileManagement {</span>
    public static final String PATH_ACCOUNTS     = &quot;saves/accounts.txt&quot;;
    public static final String PATH_BUDGETS      = &quot;saves/budgets.txt&quot;;
    public static final String PATH_INVOICES     = &quot;saves/invoices.txt&quot;;
    public static final String PATH_TRANSACTIONS = &quot;saves/transactions.txt&quot;;
    public static final String PATH_USERS        = &quot;saves/users.txt&quot;;

<span class="nc" id="L24">    private static final Charset DATA_CHARSET = StandardCharsets.UTF_8;</span>
    private static final TransactionDAO TRANSACTION_DAO;
    private static final AccountDAO ACCOUNT_DAO;
    private static final InvoiceDAO INVOICE_DAO;
    private static final BudgetDAO BUDGET_DAO;
    private static final UserDAO USER_DAO;

<span class="nc" id="L31">    private static final String[] PATH_ALL = { PATH_ACCOUNTS, PATH_BUDGETS, PATH_INVOICES, PATH_TRANSACTIONS, PATH_USERS };</span>

    static {
        try {
<span class="nc" id="L35">            establishSaveFiles();</span>

            // Initialise data access objects
<span class="nc" id="L38">            TRANSACTION_DAO = new TransactionDAO(PATH_TRANSACTIONS, DATA_CHARSET);</span>
<span class="nc" id="L39">            ACCOUNT_DAO     = new AccountDAO    (PATH_ACCOUNTS,     DATA_CHARSET);</span>
<span class="nc" id="L40">            INVOICE_DAO     = new InvoiceDAO    (PATH_INVOICES,     DATA_CHARSET);</span>
<span class="nc" id="L41">            BUDGET_DAO      = new BudgetDAO     (PATH_BUDGETS,      DATA_CHARSET);</span>
<span class="nc" id="L42">            USER_DAO        = new UserDAO       (PATH_USERS,        DATA_CHARSET);</span>
<span class="nc" id="L43">        } catch (IOException e) {</span>
<span class="nc" id="L44">            throw new RuntimeException(e);</span>
<span class="nc" id="L45">        }</span>
<span class="nc" id="L46">    }</span>

    /**
    * Creates the save files for the application if they don't exist.
    * @throws IOException if an error occurs while creating the directories or files.
    */
    private static void establishSaveFiles() throws IOException {
<span class="nc bnc" id="L53" title="All 2 branches missed.">        for (String s : PATH_ALL) {</span>
<span class="nc" id="L54">            Path file = Path.of(s);</span>
<span class="nc" id="L55">            int lastFS = s.lastIndexOf('/');</span>
<span class="nc bnc" id="L56" title="All 2 branches missed.">            if (lastFS == -1)</span>
<span class="nc" id="L57">                lastFS = s.lastIndexOf('\\');</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">            if (lastFS != -1) {</span>
<span class="nc" id="L59">                Files.createDirectories(Path.of(s.substring(0, lastFS)));</span>
            }

            try {
<span class="nc bnc" id="L63" title="All 2 branches missed.">                if (Files.notExists(file))</span>
<span class="nc" id="L64">                    Files.createFile(file);</span>
<span class="nc" id="L65">            } catch (FileAlreadyExistsException e) {</span>
                // Skip
<span class="nc" id="L67">            }</span>
        }
<span class="nc" id="L69">    }</span>

    /**
    * Returns an array of all Login objects for all users in the application.
    * @return an array of Login objects.
    * @throws IOException if an error occurs while reading from the data file.
    */
    public static Login[] readLogins() throws IOException {
<span class="nc" id="L77">        return USER_DAO.getAllLogins();</span>
    }

    /**
    * Returns a User object with the specified user ID.
    * @param userId the ID of the user to retrieve.
    * @return a User object with the specified user ID.
    * @throws IOException if an error occurs while reading from the data file.
    */
    public static User readUser(String userId) throws IOException {
<span class="nc" id="L87">        User user = USER_DAO.getUser(userId);</span>

<span class="nc" id="L89">        Transaction[] transactions = TRANSACTION_DAO.getAllTransactionsForUser(userId);</span>
<span class="nc" id="L90">        Account[] accounts = ACCOUNT_DAO.getAllAccountsForUser(userId);</span>
<span class="nc" id="L91">        Invoice[] invoices = INVOICE_DAO.getAllInvoices(userId);</span>
<span class="nc" id="L92">        Budget budget = BUDGET_DAO.getBudget(userId);</span>

<span class="nc" id="L94">        return new User(accounts, invoices, user.getLoginInfo(), user.getEmail(), user.getLastName(), user.getFirstName(), transactions, budget);</span>
    }

    /**
    * Writes changes to a User object to the data file.
    * @param loggedInUser the updated User object to write to the data file.
    * @throws RuntimeException if an IOException occurs while writing to the data file.
    */
    public static void newEditUser(User loggedInUser) {
        try {
<span class="nc" id="L104">            USER_DAO.setUser(loggedInUser);</span>
<span class="nc" id="L105">        } catch (IOException e) {</span>
<span class="nc" id="L106">            throw new RuntimeException(e);</span>
<span class="nc" id="L107">        }</span>
<span class="nc" id="L108">    }</span>

    /**
    * Writes a new User object to the data file.
    * @param newUser the new User object to write to the data file.
    * @throws IllegalArgumentException if a user with the same ID already exists in the application.
    * @throws IOException if an error occurs while writing to the data file.
    */
    public static void writeNewUser(User newUser) throws IOException {
<span class="nc" id="L117">        String userID = newUser.getLoginInfo().getUserId();</span>

<span class="nc bnc" id="L119" title="All 2 branches missed.">        if (USER_DAO.getUser(userID) != null)</span>
<span class="nc" id="L120">            throw new IllegalArgumentException(&quot;A user with that user ID already exists&quot;);</span>

<span class="nc" id="L122">        USER_DAO.setUser(newUser);</span>

<span class="nc" id="L124">        Budget budget = newUser.getBudget();</span>
<span class="nc" id="L125">        Invoice[] invoices = newUser.getAllInvoices().toArray(Invoice[]::new);</span>
<span class="nc" id="L126">        Transaction[] transactions = newUser.getTransactions();</span>
<span class="nc" id="L127">        Account[] accounts = newUser.getAccounts();</span>


<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (budget != null)</span>
<span class="nc" id="L131">            BUDGET_DAO.setBudget(userID, budget);</span>

<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (invoices != null)</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">            for (Invoice invoice : invoices)</span>
<span class="nc" id="L135">                INVOICE_DAO.addNewInvoice(userID, invoice);</span>

<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (transactions != null)</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">            for (Transaction transaction : transactions)</span>
<span class="nc" id="L139">                TRANSACTION_DAO.addNewTransaction(userID, transaction);</span>

<span class="nc bnc" id="L141" title="All 2 branches missed.">        if (accounts != null)</span>
<span class="nc" id="L142">            ACCOUNT_DAO.replaceAllAccounts(userID, accounts);</span>
<span class="nc" id="L143">    }</span>

    /**
    * Deletes the specified user and all associated data from the application.
    * @param userID the ID of the user to delete.
    * @throws RuntimeException if an IOException occurs while deleting the user's data from the data file.
    */
    public static void deleteUser(String userID) {
        try {
<span class="nc" id="L152">            TRANSACTION_DAO.deleteUser(userID);</span>
<span class="nc" id="L153">            ACCOUNT_DAO.deleteUser(userID);</span>
<span class="nc" id="L154">            INVOICE_DAO.deleteUser(userID);</span>
<span class="nc" id="L155">            BUDGET_DAO.deleteUser(userID);</span>
<span class="nc" id="L156">            USER_DAO.deleteUser(userID);</span>
<span class="nc" id="L157">        } catch (IOException e) {</span>
<span class="nc" id="L158">            throw new RuntimeException(e);</span>
<span class="nc" id="L159">        }</span>
<span class="nc" id="L160">    }</span>

    /**
    * Writes a new Transaction object to the data file for the specified user.
    * @param userId the ID of the user to associate the new transaction with.
    * @param transaction the new Transaction object to write to the data file.
    * @throws RuntimeException if an IOException occurs while writing to the data file.
    */
    public static void writeTransaction(String userId, Transaction transaction) {
        try {
<span class="nc" id="L170">            TRANSACTION_DAO.addNewTransaction(userId, transaction);</span>
<span class="nc" id="L171">        } catch (IOException e) {</span>
<span class="nc" id="L172">            throw new RuntimeException(e);</span>
<span class="nc" id="L173">        }</span>
<span class="nc" id="L174">    }</span>

    /**
    * Returns an array of the specified number of the most recent transactions for the specified user.
    * @param userId the ID of the user to retrieve transactions for.
    * @param amount the number of transactions to retrieve.
    * @return an array of the specified number of the most recent transactions for the specified user.
    * @throws IOException if an error occurs while reading from the data file.
    */
    public static Transaction[] readLatestTransactions(String userId, int amount) throws IOException{
<span class="nc" id="L184">        return TRANSACTION_DAO.getLatest(userId, amount);</span>
    }

    /**
    * Writes a new or updated Account object to the data file for the specified user.
    * @param userId the ID of the user to associate the new or updated account with.
    * @param account the Account object to write to the data file.
    * @throws RuntimeException if an IOException occurs while writing to the data file.
    */
    public static void writeAccount(String userId, Account account) {
        try {
<span class="nc" id="L195">            ACCOUNT_DAO.setAccount(userId, account);</span>
<span class="nc" id="L196">        } catch (IOException e) {</span>
<span class="nc" id="L197">            throw new RuntimeException(e);</span>
<span class="nc" id="L198">        }</span>
<span class="nc" id="L199">    }</span>

    /**
    * Edits an existing Account object in the data file for the specified user.
    * @param userID the ID of the user to associate the edited account with.
    * @param account the updated Account object to write to the data file.
    * @throws RuntimeException if an IOException occurs while writing to the data file.
    */
    public static void editAccount(String userID, Account account) {
        try {
<span class="nc" id="L209">            ACCOUNT_DAO.setAccount(userID, account);</span>
<span class="nc" id="L210">        } catch (IOException e) {</span>
<span class="nc" id="L211">            throw new RuntimeException(e);</span>
<span class="nc" id="L212">        }</span>
<span class="nc" id="L213">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>